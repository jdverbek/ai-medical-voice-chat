<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardiologische AI Assistent - Speech-to-Speech</title>
    <meta name="description" content="Geavanceerde spraak-naar-spraak cardiologische anamnese met OpenAI Realtime API">
    <meta name="keywords" content="cardiologie, AI, spraakherkenning, anamnese, hartklachten">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè•</text></svg>">
    
    <!-- Styles -->
    <link rel="stylesheet" href="realtime-styles.css">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="realtime-app.js" as="script">
    <link rel="preload" href="openai-realtime-voice.js" as="script">
    
    <!-- Meta tags for PWA -->
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Cardiologie AI">
    
    <!-- Open Graph meta tags -->
    <meta property="og:title" content="Cardiologische AI Assistent">
    <meta property="og:description" content="Geavanceerde spraak-naar-spraak cardiologische anamnese">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/static/og-image.png">
    
    <!-- Security headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://api.openai.com wss://api.openai.com; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self' blob:; connect-src 'self' https://api.openai.com wss://api.openai.com;">
</head>
<body>
    <!-- Application will be dynamically loaded here -->
    
    <!-- Initial loading screen (will be replaced by JavaScript) -->
    <div id="initial-loading" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>üè• Cardiologische AI Assistent</h2>
            <p>Speech-to-Speech technologie wordt geladen...</p>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 10%;"></div>
                </div>
                <p>JavaScript modules initialiseren...</p>
            </div>
        </div>
    </div>

    <!-- Emergency fallback content -->
    <noscript>
        <div style="text-align: center; padding: 2rem; font-family: Arial, sans-serif;">
            <h1>üè• Cardiologische AI Assistent</h1>
            <p>Deze applicatie vereist JavaScript om te functioneren.</p>
            <p>Schakel JavaScript in uw browser in en herlaad de pagina.</p>
        </div>
    </noscript>

    <!-- Service Worker Registration -->
    <script>
        // Register service worker for offline functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>

    <!-- Core Application Scripts -->
    <script type="module">
        // Modern browser check
        if (!window.fetch || !window.Promise || !window.WebSocket) {
            document.body.innerHTML = `
                <div style="text-align: center; padding: 2rem; font-family: Arial, sans-serif;">
                    <h1>üè• Cardiologische AI Assistent</h1>
                    <p>Uw browser ondersteunt niet alle benodigde functies.</p>
                    <p>Update naar een moderne browser (Chrome, Firefox, Safari, Edge).</p>
                </div>
            `;
        }
    </script>

    <!-- Application JavaScript -->
    <script src="openai-realtime-fixed.js"></script>
    <script src="realtime-app-fixed.js"></script>

    <!-- Analytics and Error Tracking -->
    <script>
        // Global error handler
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            
            // Show user-friendly error message
            const errorContainer = document.getElementById('error-container');
            if (errorContainer) {
                const errorText = document.getElementById('error-text');
                if (errorText) {
                    errorText.textContent = 'Er is een onverwachte fout opgetreden. Herlaad de pagina om opnieuw te proberen.';
                    errorContainer.style.display = 'block';
                }
            }
        });

        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            event.preventDefault();
        });

        // Performance monitoring
        window.addEventListener('load', () => {
            if (window.performance && window.performance.timing) {
                const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
                console.log('Page load time:', loadTime + 'ms');
            }
        });

        // Browser compatibility warnings
        function checkBrowserCompatibility() {
            const warnings = [];
            
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                warnings.push('Microfoon toegang wordt mogelijk niet ondersteund');
            }
            
            if (!window.AudioContext && !window.webkitAudioContext) {
                warnings.push('Audio processing wordt mogelijk niet ondersteund');
            }
            
            if (!window.WebSocket) {
                warnings.push('Real-time communicatie wordt niet ondersteund');
            }
            
            if (warnings.length > 0) {
                console.warn('Browser compatibility warnings:', warnings);
            }
            
            return warnings.length === 0;
        }

        // Initialize compatibility check
        document.addEventListener('DOMContentLoaded', () => {
            const isCompatible = checkBrowserCompatibility();
            if (!isCompatible) {
                console.warn('Some features may not work properly in this browser');
            }
        });
    </script>

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Cardiologische AI Assistent",
        "description": "Geavanceerde spraak-naar-spraak cardiologische anamnese met AI",
        "applicationCategory": "HealthApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "EUR"
        },
        "featureList": [
            "Speech-to-Speech conversatie",
            "Cardiologische anamnese",
            "AI-gestuurde vragen",
            "Medische rapportage",
            "GDPR-compliant"
        ]
    }
    </script>

    <!-- Accessibility enhancements -->
    <script>
        // Keyboard navigation support
        document.addEventListener('keydown', (event) => {
            // Escape key to close modals/errors
            if (event.key === 'Escape') {
                const errorContainer = document.getElementById('error-container');
                if (errorContainer && errorContainer.style.display !== 'none') {
                    errorContainer.style.display = 'none';
                }
            }
            
            // Space bar to toggle voice recording (when in voice mode)
            if (event.code === 'Space' && event.target.tagName !== 'INPUT' && event.target.tagName !== 'TEXTAREA') {
                const voiceToggle = document.getElementById('voice-toggle');
                if (voiceToggle && voiceToggle.style.display !== 'none') {
                    event.preventDefault();
                    voiceToggle.click();
                }
            }
        });

        // Focus management for accessibility
        function manageFocus() {
            // Ensure proper focus order
            const focusableElements = document.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            
            focusableElements.forEach((element, index) => {
                if (!element.hasAttribute('tabindex')) {
                    element.setAttribute('tabindex', '0');
                }
            });
        }

        // Initialize focus management when DOM is ready
        document.addEventListener('DOMContentLoaded', manageFocus);
    </script>

    <!-- Performance optimization -->
    <script>
        // Lazy load non-critical resources
        function lazyLoadResources() {
            // Preload audio context for better performance
            if (window.AudioContext || window.webkitAudioContext) {
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                window.audioContextPreload = new AudioContextClass();
            }
        }

        // Initialize lazy loading after page load
        window.addEventListener('load', lazyLoadResources);

        // Memory management
        window.addEventListener('beforeunload', () => {
            // Clean up audio contexts and connections
            if (window.medicalVoiceApp && window.medicalVoiceApp.realtimeVoice) {
                window.medicalVoiceApp.realtimeVoice.cleanup();
            }
        });
    </script>
</body>
</html>

